{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CineScope application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "Username chosen by the user."
        },
        "joinDate": {
          "type": "string",
          "description": "Date and time when the user joined CineScope.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "username",
        "joinDate"
      ]
    },
    "Movie": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Movie",
      "type": "object",
      "description": "Represents a movie available on the CineScope platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Movie entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the movie."
        },
        "releaseYear": {
          "type": "number",
          "description": "Year when the movie was released."
        },
        "summary": {
          "type": "string",
          "description": "Brief summary or synopsis of the movie."
        },
        "posterUrl": {
          "type": "string",
          "description": "URL of the movie's poster image.",
          "format": "uri"
        },
        "trailerUrl": {
          "type": "string",
          "description": "URL of the movie's trailer.",
          "format": "uri"
        },
        "genreIds": {
          "type": "array",
          "description": "References to Genres. (Relationship: Movie N:N Genre)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "title",
        "releaseYear",
        "summary",
        "posterUrl"
      ]
    },
    "Genre": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Genre",
      "type": "object",
      "description": "Represents a genre of movies.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Genre entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the genre (e.g., Action, Comedy, Drama)."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment or review posted by a user on a movie.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Comment entity."
        },
        "movieId": {
          "type": "string",
          "description": "Reference to Movie. (Relationship: Movie 1:N Comment)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Comment)"
        },
        "text": {
          "type": "string",
          "description": "Text content of the comment."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the comment was posted.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "movieId",
        "userId",
        "text",
        "timestamp"
      ]
    },
    "Platform": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Platform",
      "type": "object",
      "description": "Represents a platform where a movie is available for watching (e.g., Netflix, Amazon Prime).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Platform entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the platform."
        },
        "isPaid": {
          "type": "boolean",
          "description": "Indicates whether the platform requires a paid subscription."
        }
      },
      "required": [
        "id",
        "name",
        "isPaid"
      ]
    },
    "MoviePlatform": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MoviePlatform",
      "type": "object",
      "description": "Represents the availability of a movie on a specific platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MoviePlatform entity."
        },
        "movieId": {
          "type": "string",
          "description": "Reference to Movie. (Relationship: Movie 1:N MoviePlatform)"
        },
        "platformId": {
          "type": "string",
          "description": "Reference to Platform. (Relationship: Platform 1:N MoviePlatform)"
        }
      },
      "required": [
        "id",
        "movieId",
        "platformId"
      ]
    },
    "Recommendation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Recommendation",
      "type": "object",
      "description": "Represents a movie recommendation for a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Recommendation entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Recommendation)"
        },
        "movieId": {
          "type": "string",
          "description": "Reference to Movie. (Relationship: Movie 1:N Recommendation)"
        },
        "reason": {
          "type": "string",
          "description": "Reason for recommending this movie to the user."
        },
        "timestamp": {
          "type": "string",
          "description": "Date and time when the recommendation was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "movieId",
        "reason",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Access is restricted to the user identified by {userId}.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/movies/{movieId}",
        "definition": {
          "entityName": "Movie",
          "schema": {
            "$ref": "#/backend/entities/Movie"
          },
          "description": "Stores movie details. Publicly accessible.",
          "params": [
            {
              "name": "movieId",
              "description": "The unique identifier for the movie."
            }
          ]
        }
      },
      {
        "path": "/genres/{genreId}",
        "definition": {
          "entityName": "Genre",
          "schema": {
            "$ref": "#/backend/entities/Genre"
          },
          "description": "Stores movie genres. Publicly accessible.",
          "params": [
            {
              "name": "genreId",
              "description": "The unique identifier for the genre."
            }
          ]
        }
      },
      {
        "path": "/movies/{movieId}/comments/{commentId}",
        "definition": {
          "entityName": "Comment",
          "schema": {
            "$ref": "#/backend/entities/Comment"
          },
          "description": "Stores comments for each movie. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "movieId",
              "description": "The unique identifier for the movie."
            },
            {
              "name": "commentId",
              "description": "The unique identifier for the comment."
            }
          ]
        }
      },
      {
        "path": "/platforms/{platformId}",
        "definition": {
          "entityName": "Platform",
          "schema": {
            "$ref": "#/backend/entities/Platform"
          },
          "description": "Stores information about platforms. Publicly accessible.",
          "params": [
            {
              "name": "platformId",
              "description": "The unique identifier for the platform."
            }
          ]
        }
      },
      {
        "path": "/moviePlatforms/{moviePlatformId}",
        "definition": {
          "entityName": "MoviePlatform",
          "schema": {
            "$ref": "#/backend/entities/MoviePlatform"
          },
          "description": "Stores the relationship between movies and platforms.",
          "params": [
            {
              "name": "moviePlatformId",
              "description": "The unique identifier for the moviePlatform entry."
            }
          ]
        }
      },
      {
        "path": "/recommendations/{recommendationId}",
        "definition": {
          "entityName": "Recommendation",
          "schema": {
            "$ref": "#/backend/entities/Recommendation"
          },
          "description": "Stores movie recommendations for users. Access is restricted to admin roles.",
          "params": [
            {
              "name": "recommendationId",
              "description": "The unique identifier for the recommendation."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. User data is stored in a path-based structure under `/users/{userId}` providing ownership-based security. Movies, Genres and Platforms are stored in root collections, as their access isn't strictly user-dependent. Comments are stored as subcollections under each movie to allow for efficient retrieval and management. MoviePlatform documents represent the many-to-many relationship between Movies and Platforms.\n\nAuthorization Independence is achieved by avoiding `get()` calls in security rules. The `comments` subcollection denormalizes the `userId` in each comment, allowing rules to validate comment ownership without fetching user data.\n\nQAPs are supported through structural segregation and the membership model. Access to user profiles is restricted to the owning user via path-based rules. Collaborative data, like comments, does not utilize a membership model as no collaborative authoring is provided for."
  }
}